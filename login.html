<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Вход</title>
  <link rel="stylesheet" href="css/auth.css">
  <script src="https://kit.fontawesome.com/97ebdf5864.js" crossorigin="anonymous"></script>
</head>
<body>
    <style>
        body {
            background:  url('https://i.pinimg.com/originals/12/4e/40/124e4014582b4dc62dd3bc8547d21659.gif?nii=t') no-repeat center/cover fixed;
        }
    </style>
  <div class="container">
    <h2>Вход</h2>

    <form action="/login" method="POST" novalidate>
      <!-- Имя или телефон -->
      <div class="form-group">
        <input id="login" name="login" type="text" required placeholder=" " minlength="2" />
        <label for="login">Имя или номер телефона</label>
        <i class="fa-solid fa-user"></i>
      </div>

      <!-- Пароль -->
      <div class="form-group">
        <input id="password" name="password" type="password" required placeholder=" " minlength="6" />
        <label for="password">Пароль</label>
        <i id="togglePassword" class="fa-solid fa-eye" style="cursor: pointer;"></i>
      </div>

      <button id="btn" type="submit">Войти</button>

      <p>Нет аккаунта? <a class="link" href="register.html">Зарегистрироваться</a></p>
    </form>
  </div>

 <script>
// Показать/скрыть пароль (остаётся без изменений)
const togglePassword = document.getElementById('togglePassword');
const password = document.getElementById('password');

togglePassword.addEventListener('click', function () {
  const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
  password.setAttribute('type', type);
  this.classList.toggle('fa-eye');
  this.classList.toggle('fa-eye-slash');
});

// Отправка формы как x-www-form-urlencoded
const loginForm = document.querySelector('form');
loginForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const formData = new FormData(loginForm);
  const params = new URLSearchParams();
  for (const [key, value] of formData) {
    params.append(key, value);
  }

  try {
    const response = await fetch('/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: params
    });

    const data = await response.json();

    if (data.success) {
      window.location.href = '/';
    } else {
      alert(data.error || 'Ошибка входа');
    }
  } catch (err) {
    alert('Ошибка соединения с сервером');
  }
});


</script>
</body>
</html>